%Udarbejdet af Magnus Overby
% Her definerer jeg min "makro" som laver en udregning for mig
\newenvironment{Ik1MinSekTrafoHV}[7]%{Rnet}{Xnet}{Rkab}{Xkab}{Rtra}{Xtra}{trafoNavn,ZnetNavn,ZkabelNavn,IkMin/max}
{
% I følgende udskifter jeg kommaer med punktum i mine variabler. FP-pakken regner med punktum.
% Hver variabel starter med # og derefter nummeret i rækken.
% Fx er SK værdien variabel nummer 3
\StrSubstitute{#1}{,}{.}[\Rnet]%
\StrSubstitute{#2}{,}{.}[\Xnet]%
\StrSubstitute{#3}{,}{.}[\Rkab]%
\StrSubstitute{#4}{,}{.}[\Xkab]%
\StrSubstitute{#5}{,}{.}[\Rtra]%
\StrSubstitute{#6}{,}{.}[\Xtra]%
\readlist\arg{#7}

\FPeval\sqrTre{root(2,3)}

%Læg alle resistanser sammen.
\FPeval\SumR{\Rnet + \Rkab + \Rtra}

%læg alle reaktanser sammen.
\FPeval\SumX{\Xnet + \Xkab + \Xtra}

%my man pythagoros got the drip
\FPeval\Zpow{pow(2,\SumR) + pow(2,\SumX)}
\FPeval\Z{root(2,\Zpow)}

%Regn korslutningen
\FPeval\result{clip(round(10000/(\Z * \sqrTre) * 1/ \sqrTre:2))}

\def\enhed{A}%
\begin{align*}
   	I'_{k1,\arg[4],\arg[1]} &= \frac{U_{n}}{\sqrt{3} \cdot (Z_{\arg[2]} + Z_{\arg[3]} + Z_{\arg[1]})} \cdot \frac{1}{\sqrt{3}}\\
   	&= \frac{10000}{\sqrt{3} \cdot ((\Rnet + j\Xnet) + (\Rkab + j\Xkab) + (\Rtra + j\Xtra))} \cdot \frac{1}{\sqrt{3}}\\
   	&=\result \enhed
\end{align*}
}


